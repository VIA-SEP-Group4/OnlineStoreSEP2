
CREATE SCHEMA eshop;

CREATE TABLE eshop.customers(
	customer_id SERIAL,
	user_name varchar(20) UNIQUE,
	pass varchar(20),
	email varchar(50),
	first_name varchar(20),
	last_name varchar(20),
	PRIMARY KEY (customer_id)
);


CREATE TABLE eshop.employees
(
	employee_id SERIAL,
	first_name VARCHAR(25) NOT NULL,
	last_name VARCHAR(25) NOT NULL,
	pin INTEGER CHECK(pin>=1000 AND pin<=9999),
	employee_type VARCHAR(30) NOT NULL,
	PRIMARY KEY (employee_id)
);


CREATE TABLE eshop.products
(
	product_id SERIAL,
	product_name VARCHAR(20) NOT NULL UNIQUE,
	description VARCHAR(100),
	type VARCHAR(30),
	quantity INTEGER,
	price DECIMAL,
	PRIMARY KEY (product_id)
);

CREATE TABLE eshop.orders
(
	order_id SERIAL,
	customer_id INTEGER,
	warehouse_worker_id INTEGER,
	status VARCHAR(20) DEFAULT('waiting'),
	timestamp TIMESTAMP,
	FOREIGN KEY (customer_id) references eshop.customers(customer_id),
	FOREIGN KEY (warehouse_worker_id) references eshop.employees(employee_id),
	PRIMARY KEY (order_id)
);

CREATE TABLE eshop.ordered_products
(
	product_id INTEGER,
	order_id INTEGER,
	quantity INTEGER,
	FOREIGN KEY (product_id) references eshop.products(product_id),
	FOREIGN KEY (order_id) references eshop.orders(order_id),
	PRIMARY KEY (order_id, product_id)
);

-- => for testing purposes !!! <=
INSERT INTO eshop.employees(employee_id, first_name, last_name, pin, employee_type) VALUES(1, 'fname', 'lname', 1111, 'ADMIN');
INSERT INTO eshop.customers(user_name, pass, email, first_name, last_name) VALUES('username', 'pass', 'email', 'fname', 'lname');
INSERT INTO eshop.products(product_name, description, type, quantity, price) VALUES('product', 'description ...', 'type', 100, 9.99);
INSERT INTO eshop.products(product_name, description, type, quantity, price) VALUES('prod', 'desadsd s..', 'type-bb', 55, 15.99);
